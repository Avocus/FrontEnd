variables:
  GITHUB_REPO_URL: 'https://$(GITHUB_TOKEN)@github.com/Avocus/FrontEnd.git'

trigger:
  branches:
    include:
      - main  # Executa o pipeline quando a branch 'main' for atualizada

pool:
  name: 'Default'

steps:    
  # Passo 1: Configurar o Git
  - script: |
      git config --global user.email "avocuss@gmail.com"
      git config --global user.name "Avocuss"
    displayName: 'Configurar Git'

  # Passo 2: Clonar o repositório da Azure (código atual)
  - checkout: self

  # Passo 3: Adicionar o repositório do GitHub como remote
  - script: |
      git remote add github https://$(GITHUB_TOKEN)@github.com/Avocus/FrontEnd.git
      git fetch github
    displayName: 'Adicionar GitHub como remote'

  # Passo 4: Criar nova branch a partir da branch main
  - script: |
      git checkout -b nova-branch  # Cria uma nova branch a partir de 'main'
      git fetch origin
      git reset --hard origin/main  # Garantir que o repositório local esteja limpo e igual à Azure
      git clean -fd  # Remover arquivos não rastreados
    displayName: 'Criar e atualizar nova branch'

  # Passo 5: Forçar o envio da nova branch para o GitHub
  - script: |
      git push --force github nova-branch  # Enviar a nova branch para o GitHub, forçando a substituição do histórico
    displayName: 'Push forçado para o GitHub'
