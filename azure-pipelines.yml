trigger:
  branches:
    include:
      - main  # Executa o pipeline quando a branch 'main' for atualizada

pool:
  name: 'Default'

steps:    
  # Passo 1: Configurar o Git com logs detalhados
  - script: |
      set -x
      echo "Configurando Git..."
      git config --global user.email "avocuss@gmail.com"
      git config --global user.name "Avocuss"
    displayName: 'Configurar Git'

  # Passo 2: Clonar o repositório do Azure
  - checkout: self

  # Passo 3: Adicionar o repositório do GitHub como remote com logs
  - script: |
      set -x
      echo "Adicionando GitHub como remote..."
      git remote add github https://$(GITHUB_TOKEN)@github.com/Avocus/FrontEnd.git || echo "Remote 'github' já existe"
      git remote -v
      git fetch github -v
    displayName: 'Adicionar GitHub como remote'

  # Passo 4: Atualizar a branch main com logs detalhados
  - script: |
      set -x
      echo "Atualizando branch main..."
      git fetch github -v
      git checkout main -v
      git reset --hard HEAD -v
    displayName: 'Checar a branch main e pegar atualizações'

  # Passo 5: Verificar o estado do repositório com logs detalhados
  - script: |
      set -x
      echo "Exibindo estado do repositório..."
      git status -v
      git log --oneline --graph --decorate -v
    displayName: 'Verificar estado do repositório'

  # Passo 6: Verificar os repositórios remotos
  - script: |
      set -x
      echo "Listando repositórios remotos..."
      git remote -v
    displayName: 'Verificar repositórios remotos'

  # Passo 7: Fazer push da branch main para o GitHub com logs
  - script: |
      set -x
      echo "Realizando push force para o GitHub..."
      git push --force -v github main
    displayName: 'Push para o GitHub'

  # Passo 8: Verificar o estado final do repositório após o push
  - script: |
      set -x
      echo "Estado final do repositório:"
      git status -v
    displayName: 'Status final do repositório'
