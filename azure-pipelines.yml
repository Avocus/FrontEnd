trigger:
  branches:
    include:
      - main  # Aciona o pipeline quando a branch 'main' for atualizada

pool:
  name: 'Default'

steps:
  # Passo 1: Checkout completo da branch main (sem clone superficial)
  - checkout: self
    fetchDepth: 0

  # Passo 2: Configurar o Git com suas credenciais
  - script: |
      echo Configurando Git...
      git config --global user.email "avocuss@gmail.com"
      git config --global user.name "Avocuss"
    displayName: 'Configurar Git'

  # Passo 3: Exibir o commit atual para conferência
  - script: |
      echo Commit atual:
      git rev-parse HEAD
    displayName: 'Verificar commit atual'

  # Passo 4: Adicionar o repositório do GitHub como remote
  - script: |
      echo Adicionando repositório GitHub como remote...
      rem Remove remote 'github' se já existir (ignora erro, se não existir)
      git remote remove github 2>NUL || echo "Remote 'github' não existia"
      git remote add github https://$(GITHUB_TOKEN)@github.com/Avocus/FrontEnd.git
      git remote -v
    displayName: 'Adicionar GitHub como remote'

  # Passo 5: Push da branch main para o GitHub
  - script: |
      echo Enviando código para a branch main do GitHub...
      git push --force github main
    displayName: 'Push para o GitHub'
